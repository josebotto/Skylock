#include <xc.h>
#include "compile_code.h"
#include "eeprom.h"


#ifdef COMPILAR_PLACA_PCC
    // EEprom 0x00 a 0x0F
    __EEPROM_DATA(0x50, 0x43, 0x43, 0x5F, 0x33, 0x2E, 0x30, 0x20);      // Texto:¨PCC_3.0 Skylock_1.0 www.digicard.net Argentina¨
    __EEPROM_DATA(0x53, 0x6B, 0x79, 0x6C, 0x6F, 0x63, 0x6B, 0x5F);     

    // EEprom 0x10 a 0x1F
    __EEPROM_DATA(0x31, 0x2E, 0x30, 0x20, 0x77, 0x77, 0x77, 0x2E);
    __EEPROM_DATA(0x64, 0x69, 0x67, 0x69, 0x63, 0x61, 0x72, 0x64);        

    // EEprom 0x20 a 0x2F
    __EEPROM_DATA(0x2E, 0x6E, 0x65, 0x74, 0x20, 0x41, 0x72, 0x67);
    __EEPROM_DATA(0x65, 0x6E, 0x74, 0x69, 0x6E, 0x61, 0x20, 0x20);        

#else
    // EEprom 0x00 a 0x0F
    __EEPROM_DATA(0x50, 0x43, 0x4C, 0x5F, 0x32, 0x2E, 0x30, 0x20);      // Texto:¨PCL_2.0 Skylock_1.0 www.digicard.net Argentina¨
    __EEPROM_DATA(0x53, 0x6B, 0x79, 0x6C, 0x6F, 0x63, 0x6B, 0x5F);     

    // EEprom 0x10 a 0x1F
    __EEPROM_DATA(0x31, 0x2E, 0x30, 0x20, 0x77, 0x77, 0x77, 0x2E);
    __EEPROM_DATA(0x64, 0x69, 0x67, 0x69, 0x63, 0x61, 0x72, 0x64);        

    // EEprom 0x20 a 0x2F
    __EEPROM_DATA(0x2E, 0x6E, 0x65, 0x74, 0x20, 0x41, 0x72, 0x67);
    __EEPROM_DATA(0x65, 0x6E, 0x74, 0x69, 0x6E, 0x61, 0x20, 0x20);        
#endif

// EEprom 0x30 a 0x3F
__EEPROM_DATA(0x7E, 0xFF, 0x03, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF);
__EEPROM_DATA(0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF);      // Factory Default: ID-PD          -> Posicion 0x00 = 0x7E (OSDP_PD_Factory_Default) 
                                                                    //                  Baud Rate 9600 -> Posicion 0x01 = 0xFF(SPBRG)    Baud Rate 9600 8N1
                                                                    //                                    Posicion 0x02 = 0x03(SPBRGH)

// EEprom 0x40 a 0x4F
__EEPROM_DATA(0x7E, 0xFF, 0x03, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF);
__EEPROM_DATA(0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF);      // Initialization data(User Default): ID-PD     -> Posicion 0x10  
                                                                    //                                    Baud Rate -> Posicion 0x11 = SPBRG    
                                                                    //                                                 Posicion 0x12 = SPBRGH

// EEprom 0x50 a 0x5F
__EEPROM_DATA(0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF);
__EEPROM_DATA(0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF);      // Power_on and Resets counter: -> Posicion 0x20 = Power-on Reset
                                                                    //                                 Posicion 0x21 = Brown-out Reset
                                                                    //                                 Posicion 0x22 = Watchdog Time-out 
                                                                    //                                 Posicion 0x23 = Power-Down Detection
                                                                    //                                 Posicion 0x24 = RESET Instruction

// EEprom 0x60 a 0x6F
__EEPROM_DATA(0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF);
__EEPROM_DATA(0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF);

// EEprom 0x70 a 0x7F
__EEPROM_DATA(0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF);
__EEPROM_DATA(0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF);

// EEprom 0x80 a 0x8F
__EEPROM_DATA(0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF);
__EEPROM_DATA(0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF);

// EEprom 0x90 a 0x9F
__EEPROM_DATA(0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF);
__EEPROM_DATA(0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF);

// EEprom 0xA0 a 0xAF
__EEPROM_DATA(0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF);
__EEPROM_DATA(0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF);

// EEprom 0xB0 a 0xBF
__EEPROM_DATA(0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF);
__EEPROM_DATA(0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF);

// EEprom 0xC0 a 0xCF
__EEPROM_DATA(0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF);
__EEPROM_DATA(0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF);

// EEprom 0xD0 a 0xDF
__EEPROM_DATA(0x4A, 0x6F, 0x73, 0x65, 0x20, 0x44, 0x20, 0x42);      // * Jose D Botto *
__EEPROM_DATA(0x6F, 0x74, 0x74, 0x6F, 0x20, 0x20, 0x20, 0x20);     

// EEprom 0xE0 a 0xEF
__EEPROM_DATA(0x56, 0x69, 0x63, 0x74, 0x6F, 0x72, 0x69, 0x61);     
__EEPROM_DATA(0x20, 0x20, 0x32, 0x39, 0x30, 0x36, 0x30, 0x34);     

// EEprom 0xF0 a 0xFF
__EEPROM_DATA(0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF);
__EEPROM_DATA(0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF);


unsigned char read_eeprom(unsigned char direction)
{
    EEADR=direction;      // Direccion de la eeprom que se quiere leer
    EECON1bits.EEPGD=0;   // Para acceder a la memoria EEPROM PIC
    EECON1bits.RD=1;      // Habilita la lectura de la EEPROM PIC
    return EEDATA;        // En el registro EEDATA se encuentra el dato
                          // leido, la función retorna el dato leido
}

void write_eeprom(unsigned char direction, unsigned char data)
{
    while(EECON1bits.WR==1);  // Mientras se esté realizando alguna escritura
                              // anterior espera
    EEADR=direction;          // Se carga la dirección donde se quiere escribir
    EEDATA=data;              // Se carga el dato que se quiere escribir
    EECON1bits.EEPGD=0;       // Para acceder a la memoria EEPROM PIC
    EECON1bits.WREN=1;        // Habilita la escritura en la EEPROM PIC
    INTCONbits.GIE=0;         // Deshabilita las interrupciones
    EECON2=0x55;              // Cargar en EECON2 0x55
    EECON2=0xAA;              // Cargar en EECON2 0xaa
    EECON1bits.WR=1;          // Inicia la escritura en la EEPROM PIC
    INTCONbits.GIE=1;         // Habilita las interrupciones
    EECON1bits.WREN=0;        // Deshabilita la escritura en la EEPROM PIC
    while(EECON1bits.WR==1);  // Mientras se esté realizando la escritura espera
}
